<form class="ml-4" name="container-form" method="POST" action="/courses/handle-form-actions">
    <h3 class="m-4 text-center">Khóa Học Của Tôi</h3>
    {{#if deletedCount}}
    <a href="/me/trash/courses">Thùng rác ({{deletedCount}})</a>
    {{/if}}

    <div class="mt-4 d-flex align-items-center">
        <div class="form-group form-check mt-2">
            <input type="checkbox" class="form-check-input" id="checkbox-all">
            <label class="form-check-label" for="checkbox-all">Chọn tất cả</label>
        </div>
        <div class="form-group col-md-2 mt-2">
            <select id="inputState" class="form-control" name="action" required>
                <option value="">-- Chọn hành động --</option>
                <option value="delete">Xóa</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary btn-sm btn-submit" disabled>Thực hiện</button>
    </div>

</form>
<table class="table m-4">
    <thead>
        <tr>
            <th></th>
            <th scope="col">STT</th>
            <th scope="col">Tên khóa học 
                {{{sortable 'name' _sort}}}
            </th>
            <th scope="col">Hình ảnh</th>
            <th scope="col" colspan="2">Thời gian tạo
                {{{sortable 'createdAt' _sort}}}
            </th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        {{#each courses}}
        <tr>
            <th><input type="checkbox" class="form-check-input" name="courseIds" value="{{this._id}}"></th>
            <th scope="row">{{sum @index 1}}</th>
            <td>{{this.name}}</td>
            <td><img src="{{this.image}}" alt="" class="img-item"></td>
            <td>{{this.createdAt}}</td>
            <td><a href="/courses/{{this._id}}/edit" class="btn btn-link">Sửa</a></td>
            <td><a href="" class="btn btn-link" data-toggle="modal" data-id="{{this._id}}"
                    data-target="#exampleModal">Xóa</a></td>
        </tr>
        {{else}}
        <tr>
            <td colspan="6" class="text-center">Bạn chưa đăng khóa học nào. <a href="/courses/create">Đăng khóa học</a></td>
            
        </tr>
        {{/each}}
    </tbody>
</table>



<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xác nhận xóa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Bạn có muốn xóa khóa học này không?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button id="btn-delete-course" type="button" class="btn btn-danger">Xóa</button>
            </div>
        </div>
    </div>
</div>

{{!-- delete-course-form-hidden --}}
<form id="deleteCourseForm" method="POST"></form>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        var courseId;
        var btnDeleteCourse = document.getElementById('btn-delete-course');
        var checkboxAll = $('#checkbox-all');
        var courseItemCheckbox = $('input[name="courseIds"]');
        var submitBtn = $('.btn-submit');
        //var formContainer = document.forms['container-form'];
        var formContainer = $('form[name="container-form"]');
        var deleteCourseForm = document.forms['deleteCourseForm'];

        //when dialog confirm show
        $('#exampleModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget)
            courseId = button.data('id')

        });



        btnDeleteCourse.onclick = function () {
            location.href = '/courses/' + courseId + '?_method=DELETE';
            deleteCourseForm.action = '/courses/' + courseId + '?_method=DELETE';
            deleteCourseForm.submit();
        };


        // when checkbox all change
        checkboxAll.change(function () {
            var isCheckedAll = $(this).prop('checked');
            courseItemCheckbox.prop('checked', isCheckedAll);
            changeStatusSubmitBtn();
        });

        // when item checkbox change
        courseItemCheckbox.change(function () {
            var isCheckedAll = courseItemCheckbox.length === $('input[name="courseIds"]:checked').length;
            checkboxAll.prop('checked', isCheckedAll);
            changeStatusSubmitBtn();
        })

        // when submit button clicked
        submitBtn.click(function () {
            var isSubmitable = !submitBtn.attr('disabled');
            if (isSubmitable) {
                formContainer.submit();
            }

        });

       

        // re-render submit button
        function changeStatusSubmitBtn() {
            var checkedCount = $('input[name="courseIds"]:checked').length; //total checkbox item is checked
            if (checkedCount > 0) {
                submitBtn.removeAttr('disabled');
            } else {
                submitBtn.attr('disabled', 'disabled');
            }
        }
    });
</script>